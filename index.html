<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Gift Catch</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: linear-gradient(to top, #09203f 0%, #537895 100%);
            font-family: 'Comic Neue', cursive;
        }
        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            isolation: isolate;
        }
        .snowflake {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            opacity: 0.8;
            pointer-events: none;
            animation: fall linear infinite;
        }
        #sleigh {
            position: absolute;
            width: 100px;
            height: 100px;
            background-image: url('https://i.postimg.cc/FKYjzjqd/Pngtree-q-version-of-santa-claus-3841265.png');
            background-size: contain;
            background-repeat: no-repeat;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            user-select: none;
        }
        .gift, .bomb, .snowman, .gingerbread {
            position: absolute;
            width: 40px;
            height: 40px;
            top: -50px;
            background-size: contain;
            background-repeat: no-repeat;
            animation: fall linear;
        }
        .gift { background-image: url('https://img.icons8.com/plasticine/100/000000/gift.png'); }
        .bomb { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ’£</text></svg>'); }
        .snowman { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">â›„</text></svg>'); }
        .gingerbread { background-image: url('https://i.postimg.cc/QCjrsLkf/Pngtree-christmas-gingerbread-man-illustration-6968184.png'); }

        #ui-container {
            position: absolute;
            top: 20px;
            right: 20px;
            left: 20px;
            color: white;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        #start-button, #restart-button {
            font-size: 24px;
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: all 0.1s ease-in-out;
        }
        #start-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #e74c3c;
            color: white;
            box-shadow: 0 4px #c0392b;
        }
        #restart-button {
            background-color: #ff93a3;
            color: white;
            box-shadow: 0 4px #e09aa5;
            margin-top: 20px;
        }
        #restart-button:hover { background-color: #ffcdd5; }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 60px;
            text-align: center;
            display: none;
            background-color: rgba(0,0,0,0.7);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        #final-stats-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 25px;
            margin-top: 20px;
        }
        .final-stat-line {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 28px;
        }
        .stat-icon {
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        .gift-icon { background-image: url('https://img.icons8.com/plasticine/100/000000/gift.png'); }
        .bomb-icon { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ’£</text></svg>'); }
        .snowman-icon { background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">â›„</text></svg>'); }
        .gingerbread-icon { background-image: url('https://i.postimg.cc/QCjrsLkf/Pngtree-christmas-gingerbread-man-illustration-6968184.png'); }

        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            color: rgb(210, 246, 254);
            display: none;
            text-shadow: 4px 4px 10px rgba(0,0,0,0.7);
            z-index: 9999;
        }
        /* ===== æ’è¡Œæ¦œèˆ‡è¼¸å…¥åå­—å½ˆçª—æ¨£å¼ ===== */
        /* åå­—è¼¸å…¥æ¡† & æ’è¡Œæ¦œæ–‡å­—å¯æ„›é¢¨æ ¼ */
        #player-name-input,
        #save-name-button,
        #leaderboard-list,
        #leaderboard-modal h2 {
            font-family: 'Comic Neue', cursive; /* å¯æ„›å­—é«” */
        }

        /* åå­—è¼¸å…¥æ¡† */
        #player-name-input {
            font-size: 18px;
            text-align: center;
            letter-spacing: 1px;   /* å¤šä¸€é»å­—è·ï¼Œçœ‹èµ·ä¾†æ´»æ½‘ */
            border: 2px solid #ff6b81;
            background: #7bd4ed;   /* æ·ºç²‰è‰²èƒŒæ™¯ */
        }

        /* æ’è¡Œæ¦œæ¨™é¡Œ */
        #leaderboard-modal h2 {
            color: #ff6b81;       /* å–œæ…¶ç²‰è‰² */
            font-size: 24px;
            margin-bottom: 15px;
        }

        /* æ’è¡Œæ¦œåå–® */
        #leaderboard-list li {
            font-size: 20px;
            color: #432cc7;
            margin: 6px 0;
        }

        /* æŒ‰éˆ• */
        #save-name-button,
        #close-leaderboard {
            font-family: 'Comic Neue', cursive;
            font-size: 18px;
            padding: 10px 20px;
            background: #ff6b81;
            color: white;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px #8dd5f4;
            transition: 0.2s;
        }

        #save-name-button:hover,
        #close-leaderboard:hover {
            background: #ff93a3;
        }

        .modal {
            display: none; 
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .modal-content {
            background: #fff;
            padding: 25px;
            border-radius: 12px;
            width: 80%;
            max-width: 320px;
            text-align: center;
            box-shadow: 0 0 15px rgba(0,0,0,0.3);
        }

        #player-name-input {
            width: 80%;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        #save-name-button,
        #close-leaderboard {
            padding: 10px 20px;
            background: #3c8cdc;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }

        #save-name-button:hover,
        #close-leaderboard:hover {
            background: #eb649c;
        }

        #leaderboard-list {
            text-align: left;
            margin: 10px auto;
            width: 80%;
        }
        
        @keyframes fall { to { transform: translateY(105vh); } }
    </style>
</head>
<body>
  
        <!-- ç©å®¶åå­—è¼¸å…¥è¦–çª— -->
    <div id="name-modal" class="modal">
        <div class="modal-content">
            <h2>è¼¸å…¥ä½ çš„åå­—</h2>
            <input id="player-name-input" type="text" placeholder="æ‚¨çš„åå­—">
            <button id="save-name-button">é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <!-- æ’è¡Œæ¦œ -->
    <div id="leaderboard-modal" class="modal">
        <div class="modal-content">
            <h2>æ’è¡Œæ¦œï¼ˆå‰äº”åï¼‰</h2>
            <ol id="leaderboard-list"></ol>
            <button id="close-leaderboard">é—œé–‰</button>
        </div>
    </div>

    <div id="game-container">
        <div id="ui-container">
            <div id="score">Score: 0</div>
            <div id="high-score">High Score: 0</div>
            <div id="timer">Time: 30</div>
        </div>

        <div id="countdown"></div>
        <button id="start-button">Start Game</button>
        <div id="sleigh"></div>

        <div id="game-over">
            Merry Christmas!
            <div id="final-stats-container">
                <div class="final-stat-line"><div class="stat-icon gift-icon"></div><span id="final-gifts-count">0</span></div>
                <div class="final-stat-line"><div class="stat-icon bomb-icon"></div><span id="final-bombs-count">0</span></div>
                <div class="final-stat-line"><div class="stat-icon snowman-icon"></div><span id="final-snowmen-count">0</span></div>
                <div class="final-stat-line"><div class="stat-icon gingerbread-icon"></div><span id="final-gingerbread-count">0</span></div>
            </div>
            <div id="final-high-score">High Score: 0</div>
            <button id="restart-button">Restart</button>
        </div>
    </div>

    <audio id="gift-sound" src="sounds/shine-11-268907.mp3" preload="auto"></audio>
    <audio id="bomb-sound" src="sounds/smoke-bomb-6761.mp3" preload="auto"></audio>
    <audio id="bgm" src="sounds/caja-de-musica-316378.mp3" loop></audio>

    <script>
    const gameContainer = document.getElementById('game-container');
    const sleigh = document.getElementById('sleigh');
    const scoreEl = document.getElementById('score');
    const timerEl = document.getElementById('timer');
    const startButton = document.getElementById('start-button');
    const gameOverEl = document.getElementById('game-over');
    const restartButton = document.getElementById('restart-button');
    const highScoreEl = document.getElementById('high-score');
    const finalHighScoreEl = document.getElementById('final-high-score');
    const finalGiftsCountEl = document.getElementById('final-gifts-count');
    const finalBombsCountEl = document.getElementById('final-bombs-count');
    const finalSnowmenCountEl = document.getElementById('final-snowmen-count');
    const finalGingerbreadCountEl = document.getElementById('final-gingerbread-count');
    const giftSound = document.getElementById('gift-sound');
    const bombSound = document.getElementById('bomb-sound');
    const bgm = document.getElementById('bgm');
    const countdownEl = document.getElementById('countdown');

    giftSound.volume = 1.0;
    bombSound.volume = 1.0;
    bgm.volume = 0.5;

    // ğŸ”Š æ–°å¢ï¼šå¯åŒæ™‚æ’­æ”¾çš„éŸ³æ•ˆå‡½å¼
    function playGiftSound() {
        const s = giftSound.cloneNode(true);
        s.volume = giftSound.volume;
        s.play().catch(()=>{});
    }

    function playBombSound() {
        const s = bombSound.cloneNode(true);
        s.volume = bombSound.volume;
        s.play().catch(()=>{});
    }

    let score = 0, timeLeft = 30;
    let gameInterval, objectInterval, timerInterval;
    let gameActive = false;
    let giftsCaught = 0, bombsCaught = 0, snowmenCaught = 0, gingerbreadCaught = 0;
    let highScore = 0;

    const HIGHSCORE_KEY = 'christmasGiftCatchHighScore';

    function loadHighScore() {
        const stored = localStorage.getItem(HIGHSCORE_KEY);
        highScore = stored ? parseInt(stored) : 0;
        highScoreEl.textContent = `High Score: ${highScore}`;
        finalHighScoreEl.textContent = `High Score: ${highScore}`;
    }
    function saveHighScore() {
        localStorage.setItem(HIGHSCORE_KEY, highScore.toString());
    }

    function startCountdown(callback) {
        let count = 3;
        countdownEl.style.display = 'block';
        countdownEl.textContent = count;

        const interval = setInterval(() => {
            count--;
            if (count > 0) {
                countdownEl.textContent = count;
            } else if (count === 0) {
                countdownEl.textContent = "GO!";
            } else {
                clearInterval(interval);
                countdownEl.style.display = 'none';
                callback();
            }
        }, 1000);
    }

    function createSnowflakes() {
        for (let i = 0; i < 100; i++) {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            const size = Math.random() * 4 + 1;
            snowflake.style.width = `${size}px`;
            snowflake.style.height = `${size}px`;
            snowflake.style.left = `${Math.random() * 100}vw`;
            snowflake.style.animationDuration = `${Math.random() * 5 + 5}s`;
            snowflake.style.animationDelay = `${Math.random() * -5}s`;
            gameContainer.appendChild(snowflake);
        }
    }

    function moveSleigh(e) {
        if (!gameActive) return;
        const gameRect = gameContainer.getBoundingClientRect();
        let x = e.clientX - gameRect.left;
        if (x < 0) x = 0;
        if (x > gameRect.width - sleigh.offsetWidth) x = gameRect.width - sleigh.offsetWidth;
        sleigh.style.left = `${x}px`;
    }

    function createFallingObject() {
        if (!gameActive) return;

        const rand = Math.random();
        const object = document.createElement('div');

        if (rand < 0.2) object.classList.add('bomb');
        else if (rand < 0.3) object.classList.add('snowman');
        else if (rand < 0.4) object.classList.add('gingerbread');
        else object.classList.add('gift');

        const progress = (30 - timeLeft) / 30;
        const initialMin = 3, initialMax = 5;
        const finalMin = 1.5, finalMax = 3;

        const currentMin = initialMin - (initialMin - finalMin) * progress;
        const currentMax = initialMax - (initialMax - finalMax) * progress;
        const duration = Math.random() * (currentMax - currentMin) + currentMin;

        object.style.left = `${Math.random() * (window.innerWidth - 40)}px`;
        object.style.animationDuration = `${duration}s`;
        gameContainer.appendChild(object);

        object.addEventListener('animationend', () => object.remove());
    }

    function checkCollisions() {
        const sleighRect = sleigh.getBoundingClientRect();
        const objects = document.querySelectorAll('.gift, .bomb, .snowman, .gingerbread');

        objects.forEach(object => {
            const rect = object.getBoundingClientRect();
            if (
                !(sleighRect.right < rect.left ||
                  sleighRect.left > rect.right ||
                  sleighRect.bottom < rect.top ||
                  sleighRect.top > rect.bottom)
            ) {
                if (object.classList.contains('snowman')) {
                    score += 2; snowmenCaught++; playGiftSound();
                } else if (object.classList.contains('gingerbread')) {
                    score += 2; gingerbreadCaught++; playGiftSound();
                } else if (object.classList.contains('gift')) {
                    score++; giftsCaught++; playGiftSound();
                } else if (object.classList.contains('bomb')) {
                    score--; bombsCaught++; playBombSound();
                }
                object.remove();
                scoreEl.textContent = `Score: ${score}`;
            }
        });
    }

    function updateTimer() {
        timeLeft--;
        timerEl.textContent = `Time: ${timeLeft}`;
        if (timeLeft <= 0) endGame();
    }

    function startGame() {
        startButton.style.display = 'none';
        gameOverEl.style.display = 'none';

        startCountdown(() => {
            bgm.play().catch(()=>{});

            gameActive = true;
            score = 0;
            timeLeft = 30;
            giftsCaught = 0;
            bombsCaught = 0;
            snowmenCaught = 0;
            gingerbreadCaught = 0;

            scoreEl.textContent = `Score: ${score}`;
            timerEl.textContent = `Time: ${timeLeft}`;
            loadHighScore();

            document.addEventListener('mousemove', moveSleigh);

            gameInterval = setInterval(checkCollisions, 100);
            objectInterval = setInterval(createFallingObject, 1000);
            timerInterval = setInterval(updateTimer, 1000);
        });
    }
            // === ç©å®¶åå­—è¼¸å…¥å½ˆçª— ===
        const nameModal = document.getElementById("name-modal");
        const nameInput = document.getElementById("player-name-input");
        const saveNameBtn = document.getElementById("save-name-button");
        saveNameBtn.textContent = "é€å‡º";
        // === æ’è¡Œæ¦œå½ˆçª— ===
        const leaderboardModal = document.getElementById("leaderboard-modal");
        const leaderboardList = document.getElementById("leaderboard-list");
        const closeLeaderboardBtn = document.getElementById("close-leaderboard");


        // ğŸ”¥ å‘¼å«é€™å€‹åœ¨ "éŠæˆ²çµæŸæ™‚"
        function onGameOver(finalScore) {
            // é¡¯ç¤ºè¼¸å…¥åå­—è¦–çª—
            nameModal.style.display = "flex";

            // æŒ‰ä¸‹å„²å­˜åå­— â†’ å­˜é€²æ’è¡Œæ¦œ
            saveNameBtn.onclick = function () {
                const playerName = nameInput.value.trim();
                if (playerName === "") return alert("è«‹è¼¸å…¥åå­—");

                saveScore(playerName, finalScore);

                nameModal.style.display = "none"; // é—œé–‰åå­—è¦–çª—
                showLeaderboard();                // è·³å‡ºæ’è¡Œæ¦œ
            };
        }


        // === å„²å­˜ç©å®¶åˆ†æ•¸ï¼ˆå­˜å…¥ localStorageï¼‰ ===
        function saveScore(name, score) {
            let records = JSON.parse(localStorage.getItem("leaderboard")) || [];

            // åŠ å…¥æ–°ç´€éŒ„
            records.push({ name, score });

            // ä¾åˆ†æ•¸é«˜ä½æ’åº
            records.sort((a, b) => b.score - a.score);

            // åªä¿ç•™å‰äº”å
            records = records.slice(0, 5);

            // å­˜å› localStorage
            localStorage.setItem("leaderboard", JSON.stringify(records));
        }


        // === é¡¯ç¤ºæ’è¡Œæ¦œè¦–çª— ===
        function showLeaderboard() {
            const records = JSON.parse(localStorage.getItem("leaderboard")) || [];

            leaderboardList.innerHTML = ""; // æ¸…ç©ºåˆ—è¡¨

            records.forEach((item, index) => {
                const li = document.createElement("li");
                li.textContent = ` ${item.name} - ${item.score} åˆ†`;
                leaderboardList.appendChild(li);
            });

            leaderboardModal.style.display = "flex";
        }


        // === é—œé–‰æ’è¡Œæ¦œ ===
        closeLeaderboardBtn.onclick = function () {
            leaderboardModal.style.display = "none";
        };

    function endGame() {
    gameActive = false;
    clearInterval(gameInterval);
    clearInterval(objectInterval);
    clearInterval(timerInterval);
    document.removeEventListener('mousemove', moveSleigh);
    bgm.pause();

    // é¡¯ç¤ºéŠæˆ²çµæŸç•«é¢
    gameOverEl.style.display = 'block';

    // æ¸…é™¤æ‰€æœ‰æ‰è½ç‰©èˆ‡é›ªèŠ±
    document.querySelectorAll('.gift, .bomb, .snowman, .gingerbread, .snowflake')
        .forEach(o => o.remove());

    // é¡¯ç¤ºæœ€çµ‚çµ±è¨ˆæ•¸å­—
    finalGiftsCountEl.textContent = giftsCaught;
    finalBombsCountEl.textContent = bombsCaught;
    finalSnowmenCountEl.textContent = snowmenCaught;
    finalGingerbreadCountEl.textContent = gingerbreadCaught;

    // æ›´æ–°æœ€é«˜åˆ†
    if (score > highScore) {
        highScore = score;
        saveHighScore();
        loadHighScore();
    }

    // ------------------------
    // â­ é€™è£¡åŠ å…¥æ’è¡Œæ¦œåŠŸèƒ½ â­
    // ------------------------
    // é¡¯ç¤ºè¼¸å…¥åå­—å½ˆçª—
    nameModal.style.display = "flex";

    saveNameBtn.onclick = function () {
        let playerName = nameInput.value.trim();
        if (!playerName) playerName = "ç©å®¶";
        if (playerName.length > 10) playerName = playerName.substring(0, 10);

        // å­˜å…¥æ’è¡Œæ¦œ
        saveScore(playerName, score);

        // é—œé–‰åå­—è¼¸å…¥è¦–çª—ï¼Œé¡¯ç¤ºæ’è¡Œæ¦œ
        nameModal.style.display = "none";
        showLeaderboard();
    };
}


    startButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', startGame);

    loadHighScore();
    createSnowflakes();
</script>

</body>
</html>
